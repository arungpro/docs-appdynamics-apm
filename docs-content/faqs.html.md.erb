---
title: AppDynamics Pivotal Cloud Foundry Tile FAQs
owner: Partners
---

## <a id='GeneralFAQs'></a> General FAQs

### <a id='g1'></a> What is included in the AppDynamics Tile?

* **AppDynamics Service Broker** -- for application instrumentation

* **AppDynamics Machine Agent** -- for collecting PCF metrics through a custom nozzle from Loggregator

* **AppDynamics PCF Dashboard** -- an auto-generated custom dashboard that creates health rules for the above PCF metrics and neatly presents the resulting data

* **AppDynamics Analytics** -- for transaction analytics

### <a id='g2'></a> I am only interested in APM. Should I configure Machine Agent and Transaction Analytics?

For now, provide dummy values in the tile forms. We are working with Pivotal to release a lighter APM-only product soon.

### <a id='g3'></a> How do I configure SSL (On-Prem Controller deployment)?

Make sure you have included the entire certificate chain in the security config of the OpsManager director tile. This will ensure that all BOSH deployments and Diego cells can access those certificates automatically while doing SSL validation. AppDynamics deployments automatically reads the certificates, and imports them into correct keystores. No additional steps are needed. Follow the exact format with no comments, as specified in the Pivotal OpsManager documentation. Enable all SSL checkboxes in Tile Configuration Forms.

### <a id='g4'></a> How do I configure SSL (SaaS deployment)?

AppDynamics SaaS Controllers are signed with standard DigiCerts CA. They are already included in the BOSH deployments and application containers.

Enable all SSL checkboxes in Tile Configuration Forms.

### <a id='g5'></a> My installation failed. What should I send to AppDynamics Support?

Collect the error logs from the OpsManager installation page and provide the entire deployment log.

### <a id='g6'></a> I am using the v1.x tile and planning to upgrade to v4.4.x. Should I uninstall v1.x before installing v4.4.x?

Yes, since the platform metrics framework has been rewritten to use the new Firehose nozzle instead of JMX Bridge.

### <a id='g7'></a> Will my apps that are bound to older AppDynamics Service Broker instances lose instrumentation while I uninstall v1.x and install v4.4.x?

No. The apps are oblivious to tile installs and uninstalls. Once the apps are bound, the AppDynamics configuration will be present until the apps are restaged.

### <a id='g8'></a> How do I upgrade from v1.x to v4.4.x?

1. Record the names of your AppDynamics service instances and their corresponding plans before uninstalling your v1.x tile installation.

1. Uninstall your v1.x tile installation.

1. Install the v4.4.x tile with the plans you recorded.

1. Create service instances for the plans you recorded.

### <a id='g9'></a> I have carried out the procedure above. How do I restage my apps?

No additional steps are required to restage apps.


## <a id='SBFAQS'></a> AppDynamics Service Broker and Buildpacks - APM FAQs

### <a id='s1'></a> What is AppDynamics Service Broker?

AppDynamics Service Broker implements [Service Broker API](https://github.com/openservicebrokerapi/servicebroker) and provides a [credential service](https://docs.pivotal.io/pivotalcf/2-2/services/overview.html) for apps to bind. When bound, the necessary AppDynamics configuration is automatically imported into the app environment for buildpacks to read and configure AppDynamics agents.

### <a id='s2'></a> Can I bind apps to AppDynamics without the Service Broker and still instrument apps?

Yes. You can bind a user provided service by creating a user provided service. Do the following:

1. Run `cf cups SERVICE-NAME -p '{"account-access-key":"ACCESS-KEY", "account-name":"ACCOUNT", "application-name":"APP", "host-name":"HOST", "plan-description":"PLAN", "plan-name":"NAME", "port":"PORT", "ssl-enabled":TRUE|FALSE'  `

1. Bind the app to the user-provided service and restage.

### <a id='s3'></a> What language buildpacks have AppDynamics support included?

The buildpacks listed below are supported. The [AppDynamics documentation for Pivotal](https://docs.appdynamics.com/display/PCF) includes several step-by-step example workflows with sample applications.

|  Language | Workflow | Cloud Foundry Buildpack |
|---|---|---|
| Java  | [Java Application Workflow](https://docs.appdynamics.com/display/PCF/Java+Application+in+PCF+-+Monitoring+Workflow) | [Java buildpack](https://github.com/cloudfoundry/java-buildpack)  |
| .NET  | [.NET Application Workflow](https://docs.appdynamics.com/display/PCF/.NET+Application+in+PCF+-+Monitoring+Workflow)  | [.NET buildpack](https://github.com/Appdynamics/hwc-buildpack) |
| PHP  | [PHP Application Workflow](https://docs.appdynamics.com/display/PCF/PHP+Application+in+PCF+-+Monitoring+Workflow) | [PHP buildpack](https://github.com/cloudfoundry/php-buildpack)  |
| Python  | [Python Application Workflow](https://docs.appdynamics.com/display/PCF/PHP+Application+in+PCF+-+Monitoring+Workflow) | [Python buildpack](https://github.com/cloudfoundry/python-buildpack#develop)  |
| NodeJS | | [NodeJS buildpack](https://github.com/cloudfoundry/nodejs-buildpack)  |
|  Go | [Go Application Workflow](https://github.com/Appdynamics/cloudfoundry-apps/tree/master/cf-go) | [Go Cloud Foundry buildpack] (https://github.com/cloudfoundry/go-buildpack)  |

### <a id='s4'></a> I have a deployment with no internet access. How do I push the apps?

You can use the Java buildpack shipped with CF environments directly. The AppDynamics support has been merged. Any Java buildpack version released after Nov 2017 should work.

In addition, you must place the AppDynamics agent downloaded from `packages.appdynamics.com/java/index.yml`. See the [Offline Package](https://github.com/cloudfoundry/java-buildpack#offline-package) section of the _Cloud Foundry Java Buildpack_ documentation.

### <a id='s5'></a> How do I customize AppName, TierName, and NodeName?

AppDynamics Buildpacks auto-generate App, Tier, and Node names by looking into the deployed environment. You can customize this auto-generation by setting the configuration environment variables.

To override the following environment, run `cf set-env APP ENV-NAME ENV-VALUE`.

| AGENT |	APPLICATION ENV VARIABLE |	TIER ENV VARIABLE |	NODE ENV VARIABLE |
| --- | --- | --- | --- |
| Python |	APPD_APP_NAME |	APPD_TIER_NAME |	APPD_NODE_NAME |
| Java |	APPDYNAMICS_AGENT_APPLICATION_NAME |	APPDYNAMICS_AGENT_TIER_NAME |	APPDYNAMICS_AGENT_NODE_NAME |
| NodeJS |	APPDYNAMICS_AGENT_APPLICATION_NAME|	APPDYNAMICS_AGENT_TIER_NAME | APPDYNAMICS_AGENT_NODE_NAME |
| Golang |	APPD_APP_NAME |	APPD_TIER_NAME |	APPD_NODE_NAME |

### <a id='s6'></a> How do I configure the Java buildpack to fetch a particular agent version?

By default, Buildpack fetches the latest available agent entry in `packages.appdynamics.com/java/index.yml`. You can override the default behavior by setting these variables specified under [Configuration](https://github.com/cloudfoundry/java-buildpack/blob/master/docs/framework-app_dynamics_agent.md#configuration) in the [AppDynamics Agent Framework README](https://github.com/cloudfoundry/java-buildpack/blob/master/docs/framework-app_dynamics_agent.md).
  * To use a specific version, set the env JBP_CONFIG_APP_DYNAMICS_AGENT:
     + `cf set-env YOUR-APP-NAME JBP_CONFIG_APP_DYNAMICS_AGENT '{version: 4.4.111}'`
  * To use another package index, set the env JBP_CONFIG_APP_DYNAMICS_AGENT:
     + `cf set-env YOUR-APP-NAME JBP_CONFIG_APP_DYNAMICS_AGENT '{repository_root: "https://exmple.duckdns.org"}' `

### <a id='s7'></a> The Java buildpack does not fetch a particular agent version. What should I do?

If you are using the default package index, verify that the version in question is present by running `curl -sSL https://packages.appdynamics.com/java/index.yml -H "user-agent: Ruby" -H "accept-encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3" -H "accept: */*"`.

If it does not show up in the output, reach out to AppDynamics Support or the #java-buildpack channel of the Cloud Foundry Slack.

### <a id='s9'></a> My app push fails. What should I send to AppDynamics Support?

  * `cf push` logs
  * App manifest, if present

### <a id='s10'></a> My app is running, but I do not see any metrics in Controller. How do I troubleshoot?

Run `cf env application` and see if the `VCAP_SERVICES` environment variable has AppDynamics information.
     * If no, bind the app to AppDynamics service and restage.
     * If yes, ensure all credentials (Controller info, key, SSL) are correctly set. If you are using SSL, ensure it is enabled ("ssl: true") in `VCAP_SERVICES`.

### <a id='s12'></a> What should I send to AppDynamics Support?

  * cf logs {appname}
  * cf env {appname}
  * cf ssh {appname}
      + Find the process ID of the running app by running `ps aux`.
      + cat /proc/{pid}/environ
      + Agent logs

| AGENT  | LOGS  |
| ------------ | ------------ |
|  NODE.JS  | /tmp/appd/{hash} |
| JAVA   | /app/.java-buildpack/app_dynamics_agent/ver<agent_version>/logs  |


## <a id='MAFAQS'></a> AppDynamics Machine Agent - Platform Metrics FAQs

### <a id='m1'></a> What does the AppDynamics Machine Agent collect?

The AppDynamics Machine Agent deployed through the tile collects various KPI metrics of PCF environment exposed through Loggregator.

### <a id='m2'></a> How is the AppDynamics Machine Agent deployed?

The Machine Agent deployed through the tile includes a PCF monitoring extension that creates a custom nozzle and collects all the exposed KPI metrics. It is deployed as a BOSH deployment in Ops Manager.

### <a id='m3'></a> How can I verify that the Machine Agent is properly deployed?
  
1. Once the tile is configured and installed properly, go to the app you have created to collect the metrics on the Controller.
  
1. Open the Metric browser. In the metric tree, you should see `Application Infrastructure Performance -} {Tier-Name} -} Custom Metrics -} PCF Firehose Monitor`. If you find that folder, then the Machine Agent is properly deployed. You can use the custom dashboard for a cleaner view or use the Metric Browser to look at the detailed metrics without any health rules.

### <a id='m4'></a> How do I access the AppDynamics Machine Agent deployment?
  
1.  Log in to Ops Manager.

1. Find the AppDynamics deployment.

1. Log in to the AppDynamics deployment VM.
       * The Machine Agent root folder are in `/var/vcap/packages/appd_machine_agent_pkg`.
       * The Machine agent configuration and control scripts are in `cd /var/vcap/jobs/appd_machine_agent_job`.

```
bash
ubuntu@pie-20-ops-manager:~$ bosh -e gcp deployments | grep appdynamics
appdynamics-50d1e026bc3e30178992            	appd_machine_agent/4.4.337           	bosh-google-kvm-ubuntu-trusty-go_agent/3586.16	-	latest
                                                appdynamics/4.4.337

ubuntu@pie-20-ops-manager:~$ bosh -e gcp -d appdynamics-50d1e026bc3e30178992 ssh
```

### <a id='m5'></a> Where are the logs for the AppDynamics Machine Agent located?

The logs are present in the root folder of the Machine Agent in the AppDynamics BOSH VM deployment, `/var/vcap/packages/appd_machine_agent_pkg/logs`.

### <a id='m6'></a> How do I stop the AppDynamics Machine Agent?

The processes in the BOSH deloyment are managed by `monit`. Run `monit stop machineagent`.

```
bash
machineagent_server_node/7fd4d170-a563-4828-bf19-063a4d1b6b34:~$ sudo su
machineagent_server_node/7fd4d170-a563-4828-bf19-063a4d1b6b34:/var/vcap/bosh_ssh/bosh_f59d11e1eca346c# monit summary
  The Monit daemon 5.2.5 uptime: 4d 0h 17m

        Process 'machineagent'              running
        Process 'bosh-dns'                  running
        System 'system_localhost'           running
machineagent_server_node/7fd4d170-a563-4828-bf19-063a4d1b6b34:/var/vcap/bosh_ssh/bosh_f59d11e1eca346c# monit stop machineagent
```

### <a id='m7'></a> How do I customize the Machine Agent configuration?
  
1. Edit the `Controller-info.xml` folder in `/var/vcap/jobs/appd_machine_agent_job/config`.

1. Restart the Machine Agent by running `monit restart machineagent`.

### <a id='m8'></a> How do I start AppDynamics Machine Agent?

Run the `monit` script `monit start machineagent`.

### <a id='m9'></a> There is an SSL issue connecting to the Controller. How do I troubleshoot it?
  
The Machine Agent uses 3 SSL certificates:
    + `trusted_certs.pem` to talk to the Controller, which gets converted into `cacerts.jks`. Make sure your certificate chain is present in `trusted_certs.pem`.
    + `ca_cert.pem` and `cert.pem`, which are used by the nozzle. These are auto-generated by Ops Manager.

### <a id='m10'></a> I am not getting any platform metrics. What should I double-check?

1. Make sure that SSL is properly configured.

1. Make sure that the app name, tier name, and Tier-ID are properly configured.

1. Check the Machine Agent logs for errors.

### <a id='m11'></a> What should I send AppDynamics Support?
  
* Contents of the `conf` directory: `ls -al /var/vcap/packages/appd_machine_agent_pkg/conf`.
* Set the log level to debug by running `ls -al /var/vcap/packages/appd_machine_agent_pkg/conf/logging/log4j.xml` and collecting 10 minutes' worth of debug logs.


## <a id='PCFDashboardFAQS'></a> AppDynamics PCF Dashboard FAQs

### <a id='d1'></a> What is PCF Dashboard?

The PCF Dashboard Generator is a Python 3 app that generates a platform dashboard and set of health rules for PCF foundations that have installed the AppDynamics Tile v4.4.x. The generated dashboard and health rules leverage the custom metrics published by the AppDynamics Tile to the AppDynamics Controller and app configured in the tile.

### <a id='d2'></a> Where do I find this dashboard?
  
Go to **Controller UI > Dashboards and Reports > `APPNAME-TIERNAME-PCF KPI Dashboard`**.

### <a id='d3'></a> How is this dashboard created?

The dashboard application reads the KPI metrics emitted by the Machine Agent in the tile, associates them with various auto-generated health rules, and renders a custom dashboard.

### <a id='d4'></a> I don't see this dashboard. How do I troubleshoot?
  
Ensure the application is deployed properly. You should see `appdpcfdashboard-version` running.

```
bash
    pavan.krishna@OSXLTPKrishna:~/appdy$ cf target -o appdynamics-org -s appdynamics-space
    pavan.krishna@OSXLTPKrishna:~/appdy$ cf apps
        Getting apps in org appdynamics-org / space appdynamics-space as admin...
    name                       requested state   instances   memory   disk   urls
    appdpcfdashboard-4.4.337   started           1/1         128M     1G      appdpcfdashboard.cfapps.pie-20.cfplatformeng.com
```

### <a id='d5'></a> Where do I find the logs?
  
Run the command `cf logs appdpcfdashboard-VERSION` in the org `appdynamics-org` and the space `appdynamics-space`.

### <a id='d6'></a> How do I troubleshoot an SSL issue?
  
1. Run `cf ssh  appdpcfdashboard-VERSION`.

1. Ensure the correct certificate is present in `/home/vcap/app/cert.pem` of the application by running `cat /home/vcap/app/cert.pem`.

### <a id='d7'></a> How do I change a configuration variable?
  
All configuration of the application is done via environment variables. To change a variable, run `cf set-env appdpcfdashboard-VERSION ENV-NAME ENV-VER`

To list the variables, run `cf env appdpcfdashboard-VERSION`.
